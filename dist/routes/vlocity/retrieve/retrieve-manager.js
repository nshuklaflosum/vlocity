function a42_0x1b24(){const _0x1b06f7=['fs/promises','getComponentKeysByTypes','isRetry','660416HxLpON','length','\x0amanifest:\x0a\x20-\x20','Records\x20to\x20export\x20not\x20a\x20found','mkdir','flosumAuth','includes','\x5c\x27\x27','2047787ZXhfgu','isSMV','Start\x20Send\x20Vlocity\x20Temp','logs','maxDepth','updateSnapshot','7563950uFcwOB','componentNames','jsForceService','filter','isSupportAccessToken','addLogsToAttachment','updateAttachmentLog','Start\x20retrieve\x20chunk\x20','errors','adm-zip','execute','load','yaml','componentKeys','replaceAll','readErrors','data','Errors','readdir','1352826OstfxS','6936600CJkrRg','End\x20Update\x20Snapshot','js-yaml','-Export.yaml','Create\x20project\x20directory','has','sendLogs','../../../services/http','Vlocity\x20Temp','12CQvqmj','projectPath:\x20./','snapshotId','sendVlocityTemp','Start\x20Update\x20Snapshot','10261890vJKdwP','join','log','namespace','retrieveType','createProjectDirectory','Start\x20send\x20retrieved\x20data\x20','map','application/zip','Error\x20create\x20snapshot\x20','logger','push','toString','toLowerCase','readFile','Is_Completed__c','snapshotChunk','jobFiles','componentsData','prepareJobData','records','constants','4udFjXf','prepareManifests','End\x20Send\x20Vlocity\x20Temp','path','../../../constants','then','vlocityAuth','End\x20prepare\x20to\x20retrieve,\x20','1706598QSzuVv','componentTypes','./snapshot-component-sender','job-yaml-','attachmentId','some','../../../services/js-force','isSCPV','manifests','clearData','toBuffer','getJobLogFilePath','F_OK','access','\x20chunks','updateLog','Is_Error__c','logId','../../../config/dotenv','projectPath','\x0a\x20-\x20'];a42_0x1b24=function(){return _0x1b06f7;};return a42_0x1b24();}const a42_0x43b369=a42_0x2997;(function(_0x5dcfac,_0x4e2607){const _0x1aa6c1=a42_0x2997,_0x2f3b49=_0x5dcfac();while(!![]){try{const _0x4a4e31=parseInt(_0x1aa6c1(0xb5))/0x1+parseInt(_0x1aa6c1(0x9d))/0x2+parseInt(_0x1aa6c1(0xd6))/0x3*(parseInt(_0x1aa6c1(0x95))/0x4)+-parseInt(_0x1aa6c1(0xc3))/0x5+-parseInt(_0x1aa6c1(0xe0))/0x6*(-parseInt(_0x1aa6c1(0xbd))/0x7)+parseInt(_0x1aa6c1(0xd7))/0x8+-parseInt(_0x1aa6c1(0xe5))/0x9;if(_0x4a4e31===_0x4e2607)break;else _0x2f3b49['push'](_0x2f3b49['shift']());}catch(_0x3c7287){_0x2f3b49['push'](_0x2f3b49['shift']());}}}(a42_0x1b24,0xba7a6));const fs=require(a42_0x43b369(0xb2)),path=require(a42_0x43b369(0x98)),AdmZip=require(a42_0x43b369(0xcc)),yaml=require(a42_0x43b369(0xd9)),{VLOCITY_TEMP_CATALOG,UNZIP_CATALOG_NAME}=require(a42_0x43b369(0x99)),{splitOnChunks}=require('../../../services/utils'),{AvailableToExportCommand}=require('../../../services/cli-commands/available-to-export.command'),{Logger}=require('../../../services/logger'),{Retriever}=require('./retriever'),{SnapshotComponentSender}=require(a42_0x43b369(0x9f)),{JsForceHelper}=require(a42_0x43b369(0xa3)),http=require(a42_0x43b369(0xde)),{configureObject}=require(a42_0x43b369(0xaf)),jobOptions={'projectPath':'','yamlContent':'','namespace':'','snapshotId':'','logId':'','attachmentId':'','retrieveType':'selective'||'types','componentKeys':[''],'componentTypes':[''],'componentNames':[''],'flosumAuth':{'instanceUrl':'','accessToken':''},'vlocityAuth':{'instanceUrl':'','accessToken':''},'maxDepth':0x0,'isRetry':![],'isSMV':![],'isSCPV':![],'logger':new Logger()};class RetrieveManager{constructor({projectPath:_0x336863,yamlContent:_0x5bf9c8,namespace:_0x587013,snapshotId:_0x140eea,logId:_0x22b6e7,attachmentId:_0x4d2e2f,flosumAuth:_0x4b2fa2,vlocityAuth:_0x484f99,maxDepth:_0x3ab186,isRetry:_0x1971ca,isSMV:_0x537cbb,isSCPV:_0x42e030,retrieveType:_0x26ab57,componentKeys:_0x304f11,componentNames:_0x5c72ac,componentTypes:_0x441353,retrieveOptions:_0x531bd9,logger:_0x2f84b1}=jobOptions){const _0x69d26d=a42_0x43b369;this['projectPath']=_0x336863,this['yamlContent']=_0x5bf9c8,this[_0x69d26d(0xe8)]=_0x587013,this['snapshotId']=_0x140eea,this[_0x69d26d(0xae)]=_0x22b6e7,this[_0x69d26d(0xa1)]=_0x4d2e2f,this[_0x69d26d(0xba)]=_0x4b2fa2,this['vlocityAuth']=_0x484f99,this[_0x69d26d(0xc1)]=_0x3ab186,this[_0x69d26d(0xb4)]=_0x1971ca,this[_0x69d26d(0xbe)]=_0x537cbb,this[_0x69d26d(0xa4)]=_0x42e030,this['retrieveType']=_0x26ab57,this['componentKeys']=_0x304f11,this[_0x69d26d(0xc4)]=_0x5c72ac,this[_0x69d26d(0x9e)]=_0x441353,this[_0x69d26d(0xef)]=_0x2f84b1,this['manifests']={},this[_0x69d26d(0xcb)]=[],this[_0x69d26d(0xc7)]=!![],this['jsForceService']=new JsForceHelper(this[_0x69d26d(0xba)],this[_0x69d26d(0xef)]);}async[a42_0x43b369(0xea)](){const _0x2840db=a42_0x43b369;this[_0x2840db(0xef)][_0x2840db(0xe7)](_0x2840db(0xdb)),await fs[_0x2840db(0xb9)](this[_0x2840db(0xb0)],{'recursive':!![]});}async[a42_0x43b369(0xb3)](_0x46cbab){const _0x3a1db4=a42_0x43b369,_0x5752b5=_0x46cbab;if(!_0x5752b5?.[_0x3a1db4(0x93)]?.[_0x3a1db4(0xb6)])throw new Error(_0x3a1db4(0xb8));const _0x57fadf=new Set(this[_0x3a1db4(0x9e)]);return _0x5752b5[_0x3a1db4(0x93)][_0x3a1db4(0xc6)](({VlocityDataPackType:_0x2386c9,Name:_0x30618f,VlocityDataPackDisplayLabel:_0x5b761e,VlocityDataPackKey:_0x321798})=>{const _0x27a4fd=_0x3a1db4;if(!_0x57fadf[_0x27a4fd(0xdc)](_0x2386c9))return![];const _0x4a600a=_0x30618f?.['toLowerCase']()||'',_0x32bf07=_0x5b761e?.[_0x27a4fd(0xf2)]()||'',_0x4564b7=_0x321798?.[_0x27a4fd(0xf2)]()||'';return this[_0x27a4fd(0xc4)][_0x27a4fd(0xa2)](_0x39374a=>_0x4a600a['includes'](_0x39374a[_0x27a4fd(0xf2)]()))||this[_0x27a4fd(0xc4)][_0x27a4fd(0xa2)](_0x83b1c8=>_0x32bf07[_0x27a4fd(0xbb)](_0x83b1c8[_0x27a4fd(0xf2)]()))||this[_0x27a4fd(0xc4)][_0x27a4fd(0xa2)](_0x8652ff=>_0x4564b7['includes'](_0x8652ff['toLowerCase']()));})[_0x3a1db4(0xec)](({VlocityDataPackKey:_0x153077})=>'\x27'+_0x153077[_0x3a1db4(0xd1)]('\x27',_0x3a1db4(0xbc))+'\x27');}async[a42_0x43b369(0x96)](){const _0x4d93d2=a42_0x43b369;this[_0x4d93d2(0xef)][_0x4d93d2(0xe7)]('Prepare\x20manifests');const _0x4c63a4=await new AvailableToExportCommand({'vlocityAuth':this[_0x4d93d2(0x9b)],'logger':this[_0x4d93d2(0xef)]})[_0x4d93d2(0xcd)]();this[_0x4d93d2(0xa5)][_0x4d93d2(0x91)]=new Map(_0x4c63a4[_0x4d93d2(0x93)][_0x4d93d2(0xec)](({VlocityDataPackKey:_0x48d277,CreatedByName:_0x17d86b,LastModifiedByName:_0x43b787,LastModifiedDate:_0x14ab8b})=>[_0x48d277,{'createdByName':_0x17d86b,'lastModifiedByName':_0x43b787,'lastModifiedDate':_0x14ab8b}]));if(this[_0x4d93d2(0xe9)]==='selective'&&this[_0x4d93d2(0xd0)]?.[_0x4d93d2(0xb6)]){const _0x160567=this['componentKeys']['map'](_0x5dc431=>'\x27'+_0x5dc431[_0x4d93d2(0xd1)]('\x27',_0x4d93d2(0xbc))+'\x27'),_0x39f6ee=_0x4d93d2(0xe1)+UNZIP_CATALOG_NAME+_0x4d93d2(0xb7);this[_0x4d93d2(0xa5)][_0x4d93d2(0x90)]=splitOnChunks(_0x160567,configureObject[_0x4d93d2(0xf5)])[_0x4d93d2(0xec)](_0x1f4f2d=>''+_0x39f6ee+_0x1f4f2d[_0x4d93d2(0xe6)](_0x4d93d2(0xb1)));return;}if(this[_0x4d93d2(0xe9)]===_0x4d93d2(0xcf)){this[_0x4d93d2(0xa5)]['jobFiles']=[this['yamlContent']];return;}const _0x2032c7=await this[_0x4d93d2(0xb3)](_0x4c63a4),_0x56cb24=_0x4d93d2(0xe1)+UNZIP_CATALOG_NAME+'\x0amanifest:\x0a\x20-\x20';this[_0x4d93d2(0xa5)][_0x4d93d2(0x90)]=splitOnChunks(_0x2032c7,configureObject['snapshotChunk'])['map'](_0x5db8ba=>''+_0x56cb24+_0x5db8ba[_0x4d93d2(0xe6)](_0x4d93d2(0xb1)));}async[a42_0x43b369(0xa6)](){const _0x5aac43=a42_0x43b369,_0x1634e9=await fs[_0x5aac43(0xd5)](this['projectPath']);for(const _0x542ffd of _0x1634e9){if(_0x542ffd['startsWith'](_0x5aac43(0xd3)))continue;await fs['rm'](path[_0x5aac43(0xe6)](this[_0x5aac43(0xb0)],_0x542ffd),{'recursive':!![]});}}async[a42_0x43b369(0xe3)](){const _0x48995a=a42_0x43b369;if(this[_0x48995a(0xa5)][_0x48995a(0x90)][_0x48995a(0xb6)]!==0x1)return;const _0x1850aa=await this[_0x48995a(0x92)]();if(!_0x1850aa)return;this[_0x48995a(0xef)][_0x48995a(0xe7)](_0x48995a(0xbf));const _0x479b9b={'Name':'Vlocity\x20Temp','ContentType':_0x48995a(0xed),'Description':_0x48995a(0xdf),'ParentId':this[_0x48995a(0xe2)],'Body':_0x1850aa};await this[_0x48995a(0xc5)]['createAttachment'](_0x479b9b),this[_0x48995a(0xef)][_0x48995a(0xe7)](_0x48995a(0x97));}async['getJobLogFilePath'](){const _0x13c978=a42_0x43b369,_0x23b80c=path[_0x13c978(0xe6)](this['projectPath'],VLOCITY_TEMP_CATALOG),_0x1a0a22=await fs[_0x13c978(0xaa)](_0x23b80c,fs[_0x13c978(0x94)][_0x13c978(0xa9)])[_0x13c978(0x9a)](()=>!![])['catch'](()=>![]);if(!_0x1a0a22)return;const _0x197064=path[_0x13c978(0xe6)](_0x23b80c,_0x13c978(0xc0)),_0x5cce06=await fs['access'](_0x197064,fs[_0x13c978(0x94)][_0x13c978(0xa9)])[_0x13c978(0x9a)](()=>!![])['catch'](()=>![]);if(!_0x5cce06)return;const _0x32ede0=await fs[_0x13c978(0xd5)](_0x197064);if(!_0x32ede0?.['length'])return;for(const _0x53c8e7 of _0x32ede0){if(!_0x53c8e7[_0x13c978(0xbb)](_0x13c978(0xa0)))continue;if(!_0x53c8e7['includes'](_0x13c978(0xda)))continue;return path[_0x13c978(0xe6)](_0x197064,_0x53c8e7);}}async[a42_0x43b369(0x92)](){const _0x3aff13=a42_0x43b369,_0x32b75f=await this[_0x3aff13(0xa8)]();if(!_0x32b75f)return;const _0x83a69b='FlosumErrors:\x20'+JSON['stringify'](this[_0x3aff13(0xef)]['errors']);await fs['appendFile'](_0x32b75f,_0x83a69b);const _0x3f8857=new AdmZip();return _0x3f8857['addLocalFolder'](path[_0x3aff13(0xe6)](this[_0x3aff13(0xb0)],VLOCITY_TEMP_CATALOG),VLOCITY_TEMP_CATALOG),_0x3f8857[_0x3aff13(0xa7)]()[_0x3aff13(0xf1)]('base64');}async[a42_0x43b369(0xd2)](){const _0x364100=a42_0x43b369,_0x5b0215=await this['getJobLogFilePath']();if(!_0x5b0215)return;const _0x51ff59=await fs[_0x364100(0xf3)](_0x5b0215,'utf8'),_0xa39383=yaml[_0x364100(0xce)](_0x51ff59,{});if(!_0xa39383?.[_0x364100(0xd4)]?.[_0x364100(0xb6)])return;for(const _0x59218d of _0xa39383['Errors']){this[_0x364100(0xcb)]['push'](_0x59218d);}}async[a42_0x43b369(0xc8)](){const _0x426d07=a42_0x43b369;await http[_0x426d07(0xc9)](this[_0x426d07(0xb0)],this[_0x426d07(0xc5)],this[_0x426d07(0xa1)],this[_0x426d07(0xef)],!!this[_0x426d07(0xcb)][_0x426d07(0xb6)],!![]);}async[a42_0x43b369(0xac)](){const _0x17bf9c=a42_0x43b369;await http['callUpdateLog'](this[_0x17bf9c(0xc5)],this[_0x17bf9c(0xae)],this[_0x17bf9c(0xe8)],!![],this[_0x17bf9c(0xef)],!!this[_0x17bf9c(0xcb)]['length']);}async['sendLogs'](){const _0xa733cb=a42_0x43b369;await http[_0xa733cb(0xc9)](this[_0xa733cb(0xb0)],this[_0xa733cb(0xc5)],this[_0xa733cb(0xa1)],this[_0xa733cb(0xef)],![]);if(!this[_0xa733cb(0xc7)])return;await new Promise(_0x1e9d7a=>setTimeout(()=>_0x1e9d7a(),0x2710)),await this[_0xa733cb(0xdd)]();}async[a42_0x43b369(0xc2)](){const _0x267537=a42_0x43b369;this[_0x267537(0xef)][_0x267537(0xe7)](_0x267537(0xe4));const _0x5ed7e9={'Id':this['snapshotId'],[this[_0x267537(0xe8)]+_0x267537(0xf4)]:!![],[this['namespace']+_0x267537(0xad)]:!!this[_0x267537(0xcb)][_0x267537(0xb6)]};await this['jsForceService']['updateSnapshot'](this[_0x267537(0xe8)],_0x5ed7e9),this[_0x267537(0xef)][_0x267537(0xe7)](_0x267537(0xd8));}async[a42_0x43b369(0xcd)](){const _0x399168=a42_0x43b369;this['logger'][_0x399168(0xe7)]('Start\x20prepare\x20to\x20retrieve');try{this['sendLogs'](),await this[_0x399168(0xea)](),await this['prepareManifests'](),this[_0x399168(0xef)][_0x399168(0xe7)](_0x399168(0x9c)+this[_0x399168(0xa5)][_0x399168(0x90)][_0x399168(0xb6)]+_0x399168(0xab));const _0x32ed0a=new SnapshotComponentSender({'projectPath':this['projectPath'],'namespace':this[_0x399168(0xe8)],'snapshotId':this['snapshotId'],'flosumAuth':this[_0x399168(0xba)],'logger':this[_0x399168(0xef)]});let _0x50bc8a=0x1;for(const _0x37490c of this['manifests'][_0x399168(0x90)]){this[_0x399168(0xef)][_0x399168(0xe7)](_0x399168(0xca)+_0x50bc8a),await new Retriever({'projectPath':this['projectPath'],'vlocityAuth':this[_0x399168(0x9b)],'maxDepth':this[_0x399168(0xc1)],'isRetry':this[_0x399168(0xb4)],'isSMV':this[_0x399168(0xbe)],'isSCPV':this['isSCPV'],'logger':this[_0x399168(0xef)],'manifest':_0x37490c})[_0x399168(0xcd)](),this['logger'][_0x399168(0xe7)]('End\x20retrieve\x20chunk\x20'+_0x50bc8a),this[_0x399168(0xef)]['log'](_0x399168(0xeb)+_0x50bc8a),await _0x32ed0a[_0x399168(0xcd)](this[_0x399168(0xa5)][_0x399168(0x91)]),this[_0x399168(0xef)][_0x399168(0xe7)]('End\x20send\x20retrieved\x20data\x20'+_0x50bc8a),await this['readErrors'](),await this['clearData'](),_0x50bc8a++;}await this[_0x399168(0xe3)](),await fs['rm'](this[_0x399168(0xb0)],{'recursive':!![]});}catch(_0x13b618){this[_0x399168(0xef)][_0x399168(0xe7)](_0x399168(0xee)+_0x13b618),this[_0x399168(0xcb)][_0x399168(0xf0)](_0x399168(0xee)+_0x13b618),await this[_0x399168(0xac)]();}this[_0x399168(0xc7)]=![],await this[_0x399168(0xac)](),await this[_0x399168(0xc8)](),await this[_0x399168(0xc2)]();}}function a42_0x2997(_0x3f5b53,_0x5882c8){const _0x1b2465=a42_0x1b24();return a42_0x2997=function(_0x29971f,_0x113e94){_0x29971f=_0x29971f-0x90;let _0x47fe93=_0x1b2465[_0x29971f];return _0x47fe93;},a42_0x2997(_0x3f5b53,_0x5882c8);}module['exports']={'RetrieveManager':RetrieveManager};