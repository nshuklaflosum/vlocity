function a42_0x1c0d(_0x5abc85,_0x358bfd){const _0x159683=a42_0x1596();return a42_0x1c0d=function(_0x1c0d7e,_0x15b33d){_0x1c0d7e=_0x1c0d7e-0x182;let _0x26c44b=_0x159683[_0x1c0d7e];return _0x26c44b;},a42_0x1c0d(_0x5abc85,_0x358bfd);}const a42_0x20e2c0=a42_0x1c0d;(function(_0x2cda3e,_0x3824e2){const _0x3ae8bc=a42_0x1c0d,_0x25fb44=_0x2cda3e();while(!![]){try{const _0x1f0fea=parseInt(_0x3ae8bc(0x1cd))/0x1+-parseInt(_0x3ae8bc(0x1a0))/0x2*(-parseInt(_0x3ae8bc(0x1a4))/0x3)+parseInt(_0x3ae8bc(0x1c2))/0x4+parseInt(_0x3ae8bc(0x1a8))/0x5*(-parseInt(_0x3ae8bc(0x1d6))/0x6)+-parseInt(_0x3ae8bc(0x198))/0x7*(-parseInt(_0x3ae8bc(0x196))/0x8)+parseInt(_0x3ae8bc(0x1cc))/0x9+parseInt(_0x3ae8bc(0x1ba))/0xa*(-parseInt(_0x3ae8bc(0x1c8))/0xb);if(_0x1f0fea===_0x3824e2)break;else _0x25fb44['push'](_0x25fb44['shift']());}catch(_0x2b0e73){_0x25fb44['push'](_0x25fb44['shift']());}}}(a42_0x1596,0xe2a4d));const fs=require(a42_0x20e2c0(0x1cf)),path=require(a42_0x20e2c0(0x1eb)),AdmZip=require(a42_0x20e2c0(0x1b3)),yaml=require(a42_0x20e2c0(0x1ed)),{VLOCITY_TEMP_CATALOG,UNZIP_CATALOG_NAME}=require(a42_0x20e2c0(0x1d8)),{splitOnChunks}=require(a42_0x20e2c0(0x1e6)),{AvailableToExportCommand}=require(a42_0x20e2c0(0x1b6)),{Logger}=require(a42_0x20e2c0(0x1db)),{Retriever}=require('./retriever'),{SnapshotComponentSender}=require(a42_0x20e2c0(0x183)),{JsForceHelper}=require('../../../services/js-force'),http=require(a42_0x20e2c0(0x187)),{configureObject}=require(a42_0x20e2c0(0x1ae)),jobOptions={'projectPath':'','yamlContent':'','namespace':'','snapshotId':'','logId':'','attachmentId':'','retrieveType':a42_0x20e2c0(0x1a7)||'types','componentKeys':[''],'componentTypes':[''],'componentNames':[''],'flosumAuth':{'instanceUrl':'','accessToken':''},'vlocityAuth':{'instanceUrl':'','accessToken':''},'maxDepth':0x0,'isRetry':![],'isSMV':![],'isSCPV':![],'logger':new Logger()};function a42_0x1596(){const _0x34bc08=['includes','addLogsToAttachment','callUpdateLog','../../../config/dotenv','logger','getJobLogFilePath','utf8','updateLog','adm-zip','\x5c\x27\x27','isSupportAccessToken','../../../services/cli-commands/available-to-export.command','length','componentKeys','Is_Completed__c','3550LdKGfm','End\x20send\x20retrieved\x20data\x20','vlocityAuth','namespace','-Export.yaml','readErrors','isRetry','catch','1786424WIQILA','isSMV','map','Start\x20prepare\x20to\x20retrieve','F_OK','load','73381LjQCDc','createAttachment','access','\x0amanifest:\x0a\x20-\x20','5510961gFkdfL','1051846Zxqbdt','logs','fs/promises','snapshotChunk','execute','some','Start\x20send\x20retrieved\x20data\x20','createProjectDirectory','errors','6HAsPuo','\x20chunks','../../../constants','snapshotId','base64','../../../services/logger','startsWith','attachmentId','records','projectPath:\x20./','filter','\x0a\x20-\x20','Prepare\x20manifests','mkdir','appendFile','End\x20Send\x20Vlocity\x20Temp','../../../services/utils','readdir','retrieveType','readFile','addLocalFolder','path','updateAttachmentLog','js-yaml','replaceAll','jsForceService','./snapshot-component-sender','Create\x20project\x20directory','maxDepth','toString','../../../services/http','getComponentKeysByTypes','updateSnapshot','Is_Error__c','clearData','Errors','End\x20retrieve\x20chunk\x20','projectPath','Error\x20create\x20snapshot\x20','isSCPV','manifests','Start\x20retrieve\x20chunk\x20','sendLogs','toLowerCase','application/zip','16TtluRa','join','3572219LjqWAP','data','sendVlocityTemp','End\x20prepare\x20to\x20retrieve,\x20','logId','componentTypes','yamlContent','flosumAuth','4PHVBvm','log','toBuffer','job-yaml-','1744953lgzOrR','componentNames','FlosumErrors:\x20','selective','4990895NGFyoM','Start\x20Update\x20Snapshot','constants'];a42_0x1596=function(){return _0x34bc08;};return a42_0x1596();}class RetrieveManager{constructor({projectPath:_0x2fd9aa,yamlContent:_0x51383a,namespace:_0x571723,snapshotId:_0x10332e,logId:_0x32beee,attachmentId:_0x21f06a,flosumAuth:_0xb421c6,vlocityAuth:_0x1adc27,maxDepth:_0xe7fd42,isRetry:_0xfd5419,isSMV:_0x5339c0,isSCPV:_0x211426,retrieveType:_0x3f7b58,componentKeys:_0x3b5a0c,componentNames:_0x3bc06e,componentTypes:_0x2b8a9b,retrieveOptions:_0x5d4a5b,logger:_0x33df72}=jobOptions){const _0x16a196=a42_0x20e2c0;this[_0x16a196(0x18e)]=_0x2fd9aa,this['yamlContent']=_0x51383a,this[_0x16a196(0x1bd)]=_0x571723,this[_0x16a196(0x1d9)]=_0x10332e,this[_0x16a196(0x19c)]=_0x32beee,this[_0x16a196(0x1dd)]=_0x21f06a,this['flosumAuth']=_0xb421c6,this['vlocityAuth']=_0x1adc27,this[_0x16a196(0x185)]=_0xe7fd42,this[_0x16a196(0x1c0)]=_0xfd5419,this[_0x16a196(0x1c3)]=_0x5339c0,this[_0x16a196(0x190)]=_0x211426,this[_0x16a196(0x1e8)]=_0x3f7b58,this['componentKeys']=_0x3b5a0c,this[_0x16a196(0x1a5)]=_0x3bc06e,this[_0x16a196(0x19d)]=_0x2b8a9b,this['logger']=_0x33df72,this[_0x16a196(0x191)]=[],this[_0x16a196(0x1d5)]=[],this[_0x16a196(0x1b5)]=!![],this[_0x16a196(0x182)]=new JsForceHelper(this[_0x16a196(0x19f)],this[_0x16a196(0x1af)]);}async['createProjectDirectory'](){const _0x292b60=a42_0x20e2c0;this[_0x292b60(0x1af)][_0x292b60(0x1a1)](_0x292b60(0x184)),await fs[_0x292b60(0x1e3)](this['projectPath'],{'recursive':!![]});}async[a42_0x20e2c0(0x188)](){const _0x4d1aad=a42_0x20e2c0,_0x55caed=await new AvailableToExportCommand({'vlocityAuth':this[_0x4d1aad(0x1bc)],'logger':this[_0x4d1aad(0x1af)]})[_0x4d1aad(0x1d1)]();if(!_0x55caed?.[_0x4d1aad(0x1de)]?.[_0x4d1aad(0x1b7)])throw new Error('Records\x20to\x20export\x20not\x20a\x20found');const _0xcca9df=new Set(this[_0x4d1aad(0x19d)]);return _0x55caed['records'][_0x4d1aad(0x1e0)](({VlocityDataPackType:_0x14ab1d,Name:_0x50f8b2,VlocityDataPackDisplayLabel:_0x256c1d,VlocityDataPackKey:_0x26aee0})=>{const _0x51372e=_0x4d1aad;if(!_0xcca9df['has'](_0x14ab1d))return![];const _0x2ec954=_0x50f8b2?.['toLowerCase']()||'',_0x2e4a74=_0x256c1d?.[_0x51372e(0x194)]()||'',_0x1f5d2e=_0x26aee0?.[_0x51372e(0x194)]()||'';return this[_0x51372e(0x1a5)][_0x51372e(0x1d2)](_0xa73967=>_0x2ec954[_0x51372e(0x1ab)](_0xa73967[_0x51372e(0x194)]()))||this[_0x51372e(0x1a5)][_0x51372e(0x1d2)](_0x5c36f4=>_0x2e4a74[_0x51372e(0x1ab)](_0x5c36f4[_0x51372e(0x194)]()))||this[_0x51372e(0x1a5)][_0x51372e(0x1d2)](_0x55b2cd=>_0x1f5d2e[_0x51372e(0x1ab)](_0x55b2cd[_0x51372e(0x194)]()));})[_0x4d1aad(0x1c4)](({VlocityDataPackKey:_0x368243})=>'\x27'+_0x368243[_0x4d1aad(0x1ee)]('\x27','\x5c\x27\x27')+'\x27');}async['prepareManifests'](){const _0x51d3a2=a42_0x20e2c0;this['logger'][_0x51d3a2(0x1a1)](_0x51d3a2(0x1e2));if(this['retrieveType']===_0x51d3a2(0x1a7)&&this[_0x51d3a2(0x1b8)]?.[_0x51d3a2(0x1b7)]){const _0x121d56=this['componentKeys'][_0x51d3a2(0x1c4)](_0x3e5339=>'\x27'+_0x3e5339[_0x51d3a2(0x1ee)]('\x27',_0x51d3a2(0x1b4))+'\x27'),_0x399e3e=_0x51d3a2(0x1df)+UNZIP_CATALOG_NAME+_0x51d3a2(0x1cb);this[_0x51d3a2(0x191)]=splitOnChunks(_0x121d56,configureObject[_0x51d3a2(0x1d0)])['map'](_0x54a17b=>''+_0x399e3e+_0x54a17b[_0x51d3a2(0x197)](_0x51d3a2(0x1e1)));return;}if(this[_0x51d3a2(0x1e8)]==='yaml'){this['manifests']=[this[_0x51d3a2(0x19e)]];return;}const _0x285134=await this[_0x51d3a2(0x188)](),_0x327e32=_0x51d3a2(0x1df)+UNZIP_CATALOG_NAME+'\x0amanifest:\x0a\x20-\x20';this['manifests']=splitOnChunks(_0x285134,configureObject[_0x51d3a2(0x1d0)])[_0x51d3a2(0x1c4)](_0x3df60a=>''+_0x327e32+_0x3df60a[_0x51d3a2(0x197)](_0x51d3a2(0x1e1)));}async[a42_0x20e2c0(0x18b)](){const _0x4198aa=a42_0x20e2c0,_0x3a3a7c=await fs[_0x4198aa(0x1e7)](this[_0x4198aa(0x18e)]);for(const _0x12eba3 of _0x3a3a7c){if(_0x12eba3[_0x4198aa(0x1dc)](_0x4198aa(0x199)))continue;await fs['rm'](path[_0x4198aa(0x197)](this[_0x4198aa(0x18e)],_0x12eba3),{'recursive':!![]});}}async[a42_0x20e2c0(0x19a)](){const _0x7e1219=a42_0x20e2c0;if(this[_0x7e1219(0x191)][_0x7e1219(0x1b7)]!==0x1)return;const _0x43069f=await this['prepareJobData']();if(!_0x43069f)return;this[_0x7e1219(0x1af)][_0x7e1219(0x1a1)]('Start\x20Send\x20Vlocity\x20Temp');const _0x3be468={'Name':'Vlocity\x20Temp','ContentType':_0x7e1219(0x195),'Description':'Vlocity\x20Temp','ParentId':this[_0x7e1219(0x1d9)],'Body':_0x43069f};await this[_0x7e1219(0x182)][_0x7e1219(0x1c9)](_0x3be468),this[_0x7e1219(0x1af)][_0x7e1219(0x1a1)](_0x7e1219(0x1e5));}async[a42_0x20e2c0(0x1b0)](){const _0x2fc528=a42_0x20e2c0,_0x4325bd=path[_0x2fc528(0x197)](this[_0x2fc528(0x18e)],VLOCITY_TEMP_CATALOG),_0x57f14f=await fs[_0x2fc528(0x1ca)](_0x4325bd,fs[_0x2fc528(0x1aa)][_0x2fc528(0x1c6)])['then'](()=>!![])[_0x2fc528(0x1c1)](()=>![]);if(!_0x57f14f)return;const _0x4ad767=path['join'](_0x4325bd,_0x2fc528(0x1ce)),_0x48a7ef=await fs[_0x2fc528(0x1ca)](_0x4ad767,fs[_0x2fc528(0x1aa)][_0x2fc528(0x1c6)])['then'](()=>!![])[_0x2fc528(0x1c1)](()=>![]);if(!_0x48a7ef)return;const _0x5ca636=await fs['readdir'](_0x4ad767);if(!_0x5ca636?.['length'])return;for(const _0x509110 of _0x5ca636){if(!_0x509110[_0x2fc528(0x1ab)](_0x2fc528(0x1a3)))continue;if(!_0x509110[_0x2fc528(0x1ab)](_0x2fc528(0x1be)))continue;return path[_0x2fc528(0x197)](_0x4ad767,_0x509110);}}async['prepareJobData'](){const _0x2b0754=a42_0x20e2c0,_0x4d9c5e=await this[_0x2b0754(0x1b0)]();if(!_0x4d9c5e)return;const _0x577172=_0x2b0754(0x1a6)+JSON['stringify'](this['logger'][_0x2b0754(0x1d5)]);await fs[_0x2b0754(0x1e4)](_0x4d9c5e,_0x577172);const _0x544bb8=new AdmZip();return _0x544bb8[_0x2b0754(0x1ea)](path['join'](this['projectPath'],VLOCITY_TEMP_CATALOG),VLOCITY_TEMP_CATALOG),_0x544bb8[_0x2b0754(0x1a2)]()[_0x2b0754(0x186)](_0x2b0754(0x1da));}async[a42_0x20e2c0(0x1bf)](){const _0x32709c=a42_0x20e2c0,_0x224e59=await this[_0x32709c(0x1b0)]();if(!_0x224e59)return;const _0x10b2f3=await fs[_0x32709c(0x1e9)](_0x224e59,_0x32709c(0x1b1)),_0x36a1c2=yaml[_0x32709c(0x1c7)](_0x10b2f3,{});if(!_0x36a1c2?.[_0x32709c(0x18c)]?.[_0x32709c(0x1b7)])return;for(const _0x204205 of _0x36a1c2[_0x32709c(0x18c)]){this[_0x32709c(0x1d5)]['push'](_0x204205);}}async[a42_0x20e2c0(0x1ac)](){const _0x295d8c=a42_0x20e2c0;await http['updateAttachmentLog'](this['projectPath'],this[_0x295d8c(0x182)],this[_0x295d8c(0x1dd)],this[_0x295d8c(0x1af)],!!this[_0x295d8c(0x1d5)][_0x295d8c(0x1b7)],!![]);}async['updateLog'](){const _0x1dd8bc=a42_0x20e2c0;await http[_0x1dd8bc(0x1ad)](this[_0x1dd8bc(0x182)],this[_0x1dd8bc(0x19c)],this[_0x1dd8bc(0x1bd)],!![],this['logger'],!!this[_0x1dd8bc(0x1d5)][_0x1dd8bc(0x1b7)]);}async['sendLogs'](){const _0x14dcad=a42_0x20e2c0;await http[_0x14dcad(0x1ec)](this[_0x14dcad(0x18e)],this['jsForceService'],this[_0x14dcad(0x1dd)],this[_0x14dcad(0x1af)],![]);if(!this['isSupportAccessToken'])return;await new Promise(_0x29c9b6=>setTimeout(()=>_0x29c9b6(),0x2710)),await this[_0x14dcad(0x193)]();}async[a42_0x20e2c0(0x189)](){const _0x13cb9f=a42_0x20e2c0;this[_0x13cb9f(0x1af)][_0x13cb9f(0x1a1)](_0x13cb9f(0x1a9));const _0x2fa03e={'Id':this[_0x13cb9f(0x1d9)],[this[_0x13cb9f(0x1bd)]+_0x13cb9f(0x1b9)]:!![],[this['namespace']+_0x13cb9f(0x18a)]:!!this[_0x13cb9f(0x1d5)][_0x13cb9f(0x1b7)]};await this[_0x13cb9f(0x182)][_0x13cb9f(0x189)](this['namespace'],_0x2fa03e),this[_0x13cb9f(0x1af)][_0x13cb9f(0x1a1)]('End\x20Update\x20Snapshot');}async[a42_0x20e2c0(0x1d1)](){const _0x43f2d2=a42_0x20e2c0;this['logger'][_0x43f2d2(0x1a1)](_0x43f2d2(0x1c5));try{this['sendLogs'](),await this[_0x43f2d2(0x1d4)](),await this['prepareManifests'](),this['logger'][_0x43f2d2(0x1a1)](_0x43f2d2(0x19b)+this[_0x43f2d2(0x191)][_0x43f2d2(0x1b7)]+_0x43f2d2(0x1d7));const _0x2cb1cb=new SnapshotComponentSender({'projectPath':this[_0x43f2d2(0x18e)],'namespace':this[_0x43f2d2(0x1bd)],'snapshotId':this['snapshotId'],'flosumAuth':this[_0x43f2d2(0x19f)],'logger':this[_0x43f2d2(0x1af)]});let _0x1d0943=0x1;for(const _0x269ed5 of this[_0x43f2d2(0x191)]){this[_0x43f2d2(0x1af)][_0x43f2d2(0x1a1)](_0x43f2d2(0x192)+_0x1d0943),await new Retriever({'projectPath':this[_0x43f2d2(0x18e)],'vlocityAuth':this[_0x43f2d2(0x1bc)],'maxDepth':this[_0x43f2d2(0x185)],'isRetry':this[_0x43f2d2(0x1c0)],'isSMV':this['isSMV'],'isSCPV':this['isSCPV'],'logger':this[_0x43f2d2(0x1af)],'manifest':_0x269ed5})['execute'](),this[_0x43f2d2(0x1af)][_0x43f2d2(0x1a1)](_0x43f2d2(0x18d)+_0x1d0943),this[_0x43f2d2(0x1af)][_0x43f2d2(0x1a1)](_0x43f2d2(0x1d3)+_0x1d0943),await _0x2cb1cb['execute'](),this[_0x43f2d2(0x1af)][_0x43f2d2(0x1a1)](_0x43f2d2(0x1bb)+_0x1d0943),await this[_0x43f2d2(0x1bf)](),await this[_0x43f2d2(0x18b)](),_0x1d0943++;}await this[_0x43f2d2(0x19a)](),await fs['rm'](this[_0x43f2d2(0x18e)],{'recursive':!![]});}catch(_0x10dd3d){this['logger'][_0x43f2d2(0x1a1)](_0x43f2d2(0x18f)+_0x10dd3d),this['errors']['push'](_0x43f2d2(0x18f)+_0x10dd3d),await this[_0x43f2d2(0x1b2)]();}this[_0x43f2d2(0x1b5)]=![],await this[_0x43f2d2(0x1b2)](),await this[_0x43f2d2(0x1ac)](),await this[_0x43f2d2(0x189)]();}}module['exports']={'RetrieveManager':RetrieveManager};